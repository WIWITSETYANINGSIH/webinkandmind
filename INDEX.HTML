<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OURBOOKSâ€”Ink&Mind</title>
<style>
  :root{
    --brand:#111111;       /* hitam elegan */
    --accent:#ff6b00;      /* aksen hangat */
    --bg:#c8d8f3;          /* latar terang */
    --muted:#6b7280;       /* abu teks */
    --card:#ffffff;        /* kartu */
    --ring:#e5e7eb;        /* border */
    --success:#0ea5e9;     /* biru info */
    --radius:16px;
  }
  .logo-img {
  width: 40px;
  height: 40px;
  border-radius: 10px; /* sudut membulat, tetap kotak */
  object-fit: cover;
  }

  *{box-sizing:border-box}
  html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial}
  body{background:var(--bg);color:#111}
  a{color:inherit}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  .appbar{
    position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--ring);
    z-index:50
  }
  .appbar .row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#111,#333);display:grid;place-items:center;color:#fff;font-weight:700}
  .brand h1{font-size:18px;margin:0;letter-spacing:.6px}
  .brand small{display:block;color:var(--muted);font-size:12px;margin-top:-2px}
  .nav{display:flex;gap:10px;align-items:center}
  .btn,button{
    appearance:none;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;transition:.2s;
  }
  .btn.primary{background:var(--brand);color:#fff}
  .btn.primary:hover{opacity:.9}
  .btn.ghost{background:transparent;border:1px solid var(--ring)}
  .btn.accent{background:var(--accent);color:#fff}
  .tag{padding:4px 8px;border-radius:999px;background:#f3f4f6;color:#374151;font-size:12px}
  .grid{display:grid;gap:16px}
  .grid.cards{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
  .card{
    background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column;
  }
  .card .img{aspect-ratio:4/5;background:#e5e7eb;display:block;background-size:cover;background-position:center}
  .card .pad{padding:12px}
  .price{font-weight:800}
  .muted{color:var(--muted)}
  .stars{font-size:12px;color:#f59e0b}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .search{flex:1;min-width:220px;display:flex;align-items:center;border:1px solid var(--ring);background:#fff;border-radius:10px;padding:8px 10px}
  .search input{flex:1;border:none;outline:none;background:transparent}
  /* Views */
  .view{display:none;min-height:calc(100dvh - 64px)}
  .view.active{display:block;animation:fade .2s ease}
  @keyframes fade{from{opacity:.6;transform:translateY(2px)}to{opacity:1;transform:none}}
  /* Forms */
  form{display:grid;gap:10px}
  label{font-size:12px;color:var(--muted)}
  input,select,textarea{
    width:100%;padding:12px;border:1px solid var(--ring);border-radius:10px;background:#fff;outline:none
  }
  .form-card{max-width:520px;margin:24px auto;background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);padding:20px}
  .title{font-size:22px;margin:6px 0 14px}
  .sub{font-size:13px;color:var(--muted)}
  .link{color:var(--accent);text-decoration:none;font-weight:600}
  /* Cart table */
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--ring);text-align:left;font-size:14px}
  td.qty button{width:28px;height:28px}
  .right{margin-left:auto}
  .totals{display:grid;gap:8px;padding:12px;background:#fcfcfc;border:1px solid var(--ring);border-radius:12px}
  .line{display:flex;justify-content:space-between}
  .total{font-weight:800}
  /* Modal */
  dialog{border:none;border-radius:16px;padding:0;max-width:720px;width:96%}
  dialog::backdrop{background:rgba(0,0,0,.35)}
  .modal-body{display:grid;grid-template-columns:1.1fr 1fr}
  @media (max-width:800px){.modal-body{grid-template-columns:1fr}}
  .p16{padding:16px}
  .footer{padding:30px 16px;color:var(--muted);text-align:center}
</style>
</head>
<body>
  <header class="appbar">
    <div class="row container">
      <div class="brand" role="button" onclick="go('#/home')">
        <div class="logo"> <img src="ASSETLOGOOURBOOKS.png" alt="Logo" class="logo-img" />
        </div>
        <div>
          <h1>OURBOOKS</h1>
          <small>Ink & Mind</small>
        </div>
      </div>
      <div class="nav">
        <span id="helloUser" class="tag">Guest</span>
        <button class="btn ghost" onclick="go('#/cart')">Keranjang (<span id="cartCount">0</span>)</button>
        <button id="authBtn" class="btn primary" onclick="go('#/login')">Log in</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- REGISTER -->
    <section id="register" class="view">
      <div class="form-card">
        <div class="logo" style="margin-bottom:10px">OB</div>
        <div class="title">Daftar</div>
        <div class="sub">Sudah punya akun ? <a class="link" href="#/login">log in</a></div>
        <form id="registerForm">
          <div>
            <label>Number</label>
            <input name="number" type="tel" placeholder="+62..." required />
          </div>
          <div>
            <label>Email</label>
            <input name="email" type="email" placeholder="nama@email.com" required />
          </div>
          <div>
            <label>Password</label>
            <input name="password" type="password" minlength="6" required />
          </div>
          <div>
            <label>Re-password</label>
            <input name="repassword" type="password" minlength="6" required />
          </div>
          <button class="btn primary" type="submit">DAFTAR</button>
        </form>
      </div>
    </section>

    <!-- LOGIN -->
    <section id="login" class="view">
      <div class="form-card">
        <div class="logo" style="margin-bottom:10px">OB</div>
        <div class="title">Log in</div>
        <div class="sub">Belum punya akun ? <a class="link" href="#/register">Daftar</a></div>
        <form id="loginForm">
          <div>
            <label>Number / Email</label>
            <input name="identity" type="text" required />
          </div>
          <div>
            <label>Password</label>
            <input name="password" type="password" required />
          </div>
          <button class="btn primary" type="submit">LOG IN</button>
        </form>
      </div>
    </section>

    <!-- HOME / BERANDA -->
    <section id="home" class="view">
      <div class="toolbar" style="margin:10px 0 16px">
        <div class="search">
          <input id="q" placeholder="Cari buku, penulis, atau harga..." oninput="renderHome()" />
        </div>
        <select id="sort" onchange="renderHome()">
          <option value="default">Urutkan</option>
          <option value="price-asc">Harga termurah</option>
          <option value="price-desc">Harga termahal</option>
          <option value="sold-desc">Terlaris</option>
        </select>
      </div>
      <h2 style="margin:8px 0 10px">Ourbook</h2>
      <div id="productGrid" class="grid cards"></div>

      <h3 style="margin:22px 0 10px">Rekomendasi</h3>
      <div id="recoGrid" class="grid cards"></div>
    </section>

    <!-- CART -->
    <section id="cart" class="view">
      <h2>Keranjang Saya</h2>
      <div id="cartEmpty" class="muted" style="display:none">Keranjang masih kosong.</div>
      <div id="cartWrap" style="display:none">
        <table id="cartTable">
          <thead>
            <tr><th>Produk</th><th>Harga</th><th>Qty</th><th>Subtotal</th><th></th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div style="display:flex;gap:16px;flex-wrap:wrap;margin-top:14px">
          <div class="totals" style="flex:1;min-width:260px">
            <div class="line"><span>Subtotal Pesanan</span><strong id="tSubtotal">Rp 0</strong></div>
            <div class="line"><span>Sebtotal Pengiriman</span><span id="tShip">Rp 8.000,00</span></div>
            <div class="line"><span>Biaya Layanan</span><span id="tFee">Rp 2.000,00</span></div>
            <div class="line"><span>Total Diskon Pengiriman</span><span id="tShipDisc">-Rp 8.000,00</span></div>
            <div class="line"><span>Voucher Diskon</span><span id="tVoucher">-</span></div>
            <div class="line total"><span>Total Pembayaran</span><span id="tGrand">Rp 0</span></div>
          </div>
          <div class="right" style="display:flex;gap:10px;align-items:center">
            <button class="btn ghost" onclick="go('#/home')">Belanja lagi</button>
            <button class="btn accent" onclick="go('#/checkout')">CHECKOUT</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section id="checkout" class="view">
      <h2>Rincian Pembayaran</h2>
      <div style="display:grid;grid-template-columns:1.1fr .9fr;gap:16px">
        <div class="card">
          <div class="pad">
            <h3>Alamat pengiriman</h3>
            <form id="addrForm">
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                <div><label>Nama Penerima</label><input name="fullname" required value="Wiwit Setya Ningsih" /></div>
                <div><label>Nomor HP</label><input name="phone" required value="+62 851-9858-5709" /></div>
              </div>
              <div><label>Alamat</label><textarea name="address" rows="3" required>RT 003 / RW 005, Binangun Wetan, Binangun, Kec. Karangkobar, Kab. Banjarnegara 53453</textarea></div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                <div>
                  <label>Metode Pembayaran</label>
                  <select name="pay" required>
                    <option>COD</option>
                    <option>Transfer Bank</option>
                    <option>E-Wallet</option>
                  </select>
                </div>
                <div>
                  <label>Opsi Pengiriman</label>
                  <select name="ship" required>
                    <option>Reguler</option>
                    <option>Kilat</option>
                  </select>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="card">
          <div class="pad">
            <h3>Ringkasan</h3>
            <div class="totals">
              <div class="line"><span>Subtotal</span><strong id="cSubtotal">Rp 0</strong></div>
              <div class="line"><span>Pengiriman</span><span id="cShip">Rp 8.000,00</span></div>
              <div class="line"><span>Biaya Layanan</span><span id="cFee">Rp 2.000,00</span></div>
              <div class="line"><span>Diskon Pengiriman</span><span id="cShipDisc">-Rp 8.000,00</span></div>
              <div class="line"><span>Voucher</span><span id="cVoucher">-</span></div>
              <div class="line total"><span>Total</span><span id="cGrand">Rp 0</span></div>
            </div>
            <button class="btn primary" style="width:100%;margin-top:12px" onclick="placeOrder()">Buat Pesanan</button>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top:16px">
        <div class="pad">
          <h3>Barang</h3>
          <div id="checkoutItems" class="grid"></div>
        </div>
      </div>
    </section>

    <!-- SUCCESS -->
    <section id="success" class="view" style="display:grid;place-items:center;text-align:center">
      <div class="card" style="max-width:560px">
        <div class="pad">
          <div class="logo" style="margin:10px auto">OB</div>
          <h2>Terima kasih atas pesanan Anda !</h2>
          <p class="muted">Info baru akan dikirimkan ke kontak masuk notifikasi.</p>
          <div style="height:8px"></div>
          <button class="btn primary" onclick="go('#/home')">Kembali</button>
          <button class="btn ghost" onclick="go('#/orders')">Lihat pesanan</button>
        </div>
      </div>
    </section>

    <!-- ORDERS (riwayat singkat) -->
    <section id="orders" class="view">
      <h2>Pesanan</h2>
      <div id="ordersWrap" class="grid"></div>
    </section>
  </main>

  <footer class="footer">OURBOOKS â€¢ Ink & Mind</footer>

  <!-- MODAL DETAIL BUKU -->
  <dialog id="detailModal">
    <div class="modal-body">
      <div id="detailImg" class="img" style="background-image:url('https://picsum.photos/600/800?random=3')"></div>
      <div class="p16">
        <h3 id="detailTitle" style="margin:0 0 6px">Judul</h3>
        <div class="muted" id="detailMeta">Poppi Pertiwi â€¢ Coconut Books</div>
        <div class="stars" style="margin:6px 0">â˜…â˜…â˜…â˜…â˜… <span class="muted" id="detailSold">239k terjual</span></div>
        <div class="price" id="detailPrice">Rp -</div>
        <div class="tag" style="margin:8px 0">Bebas Pengembalian</div>
        <h4 style="margin:14px 0 8px">Deskripsi</h4>
        <div id="detailDesc" class="muted" style="line-height:1.5">
          -
        </div>
        <div style="display:flex;gap:8px;margin-top:16px">
          <button class="btn accent" onclick="buyNow()">Beli Sekarang</button>
          <button class="btn primary" onclick="addToCart(currentDetail)">Masukan Keranjang</button>
          <button class="btn ghost" onclick="document.getElementById('detailModal').close()">Kunjungi</button>
        </div>
      </div>
    </div>
  </dialog>

<script>
/** =========================
 *  DATA (Buku Novel)
 *  ========================= */
const products = [
  {
    id:"septian", title:"Septhian/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:99000, sold:"239k terjual",
    img:"SEPTIAN.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 99.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n436 halaman\nHarga : Rp 99.000,00\nISBN : 978-945-2365-3\nPenerbit Coconut Books`,
  },
  {
    id:"antariksa", title:"Antariksa/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:69000, sold:"23k terjual",
    img:"ANTARIKSA.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 100.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n384 halaman\nHarga : Rp 100.000,00\nISBN : 573-945-8965-3\nPenerbit Coconut Books`,
  },
  {
    id:"hujan", title:"Hujan/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:58000, sold:"29k terjual",
    img:"HUJAN.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 99.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n320 halaman\nHarga : Rp 99.000,00\nISBN : 908-995-2965-7\nPenerbit Coconut Books`,
  },
  {
    id:"tentang-kamu", title:"Tentang Kamu/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:78000, sold:"239k terjual",
    img:"TENTANG-KAMU.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 100.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n145  halaman\nHarga : Rp 100.000,00\nISBN : 908-995-25675-2\nPenerbit Coconut Books`,
  },
  {
    id:"bumi", title:"Bumi/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:40000, sold:"239k terjual",
    img:"BUMI.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 60.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n101 halaman\nHarga : Rp 60.000,00\nISBN : 908-995-2965-7\nPenerbit Coconut Books`,
  },
  {
    id:"lautan", title:"Lautan Berbicara Bulan Mendengar/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:70000, sold:"239k terjual",
    img:"LAUTAN.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 77.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n200 halaman\nHarga : Rp 77.000,00\nISBN : 908-995-2965-7\nPenerbit Coconut Books`,
  },
  {
    id:"sembagi", title:"Sembagi Arutala/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:105000, sold:"239k terjual",
    img:"SEMBAGI-ARUTALA.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 115.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n456 halaman\nHarga : Rp 115.000,00\nISBN : 908-995-2965-7\nPenerbit Coconut Books`,
  },
  {
    id:"dia-miliku", title:"Dia Miliku/Poppi Pertiwii/Coconut Books [ Original 100% ]",
    price:80000, sold:"239k terjual",
    img:"DIA-MILIKKU.jpg",
    desc:`Po 11-14 Agustus 2025 harga Rp 99.000,00\n\nPoppi Pertiwi\nUkuran : 14 x 20,5 cm\n390 halaman\nHarga : Rp 99.000,00\nISBN : 908-995-2965-7\nPenerbit Coconut Books`,
  },
];

/** STATE */
const state = {
  user: JSON.parse(localStorage.getItem('ob_user')||'null'),
  cart: JSON.parse(localStorage.getItem('ob_cart')||'[]'),
  orders: JSON.parse(localStorage.getItem('ob_orders')||'[]'),
};
let currentDetail = null;

/** HELPERS */
const rupiah = n => n.toLocaleString('id-ID',{style:'currency',currency:'IDR'});
const qs = sel => document.querySelector(sel);

function save(){
  localStorage.setItem('ob_cart', JSON.stringify(state.cart));
  localStorage.setItem('ob_orders', JSON.stringify(state.orders));
  if(state.user) localStorage.setItem('ob_user', JSON.stringify(state.user));
  renderHeader();
}

/** ROUTER */
function go(hash){ location.hash = hash; }
window.addEventListener('hashchange', () => show(location.hash||'#/home'));
function show(hash){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const id = hash.replace('#/','') || 'home';
  const el = document.getElementById(id) || document.getElementById('home');
  el.classList.add('active');
  if(id==='home'){ renderHome(); }
  if(id==='cart'){ renderCart(); }
  if(id==='checkout'){ renderCheckout(); }
  if(id==='orders'){ renderOrders(); }
}

/** HEADER */
function renderHeader(){
  qs('#helloUser').textContent = state.user ? state.user.email.split('@')[0] : 'Guest';
  qs('#authBtn').textContent = state.user ? 'Keluar' : 'Log in';
  qs('#authBtn').onclick = () => state.user ? (state.user=null, localStorage.removeItem('ob_user'), save(), go('#/login')) : go('#/login');
  qs('#cartCount').textContent = state.cart.reduce((a,b)=>a+b.qty,0);
}

/** REGISTER */
qs('#registerForm').addEventListener('submit', e=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const number=f.get('number'), email=f.get('email'), pass=f.get('password'), rep=f.get('repassword');
  if(pass!==rep){ alert('Password tidak sama'); return; }
  state.user = { number,email,pass, createdAt:Date.now() };
  save();
  alert('Akun dibuat. Selamat datang!');
  go('#/home');
});

/** LOGIN */
qs('#loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const id=f.get('identity').trim(), pass=f.get('password');
  const u = JSON.parse(localStorage.getItem('ob_user')||'null');
  if(!u){ alert('Belum ada akun. Silakan daftar.'); go('#/register'); return; }
  if((id===u.email || id===u.number) && pass===u.pass){
    state.user=u; save(); alert('Login berhasil'); go('#/home');
  }else{
    alert('Kredensial salah');
  }
});

/** HOME RENDER */
function productCard(p){
  const el = document.createElement('div');
  el.className = 'card';
  el.innerHTML = `
    <a class="img" style="background-image:url('${p.img}')" role="button"></a>
    <div class="pad">
      <div class="price">${rupiah(p.price)}</div>
      <div style="font-weight:700;margin:4px 0">${p.title}</div>
      <div class="stars">â˜…â˜…â˜…â˜…â˜… <span class="muted">${p.sold}</span></div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn accent">Beli Sekarang</button>
        <button class="btn primary">Masukan Keranjang</button>
      </div>
    </div>`;
  el.querySelector('.img').onclick = ()=>openDetail(p);
  el.querySelectorAll('.btn')[0].onclick = ()=>{ addToCart(p); go('#/checkout'); };
  el.querySelectorAll('.btn')[1].onclick = ()=>addToCart(p);
  return el;
}
function renderHome(){
  const q = (qs('#q').value||'').toLowerCase();
  const sort = qs('#sort').value;
  let list = products.filter(p => p.title.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || (''+p.price).includes(q));
  if(sort==='price-asc') list = list.sort((a,b)=>a.price-b.price);
  if(sort==='price-desc') list = list.sort((a,b)=>b.price-a.price);
  if(sort==='sold-desc') list = list.sort((a,b)=>parseInt((b.sold||'0').replace(/\D/g,'')) - parseInt((a.sold||'0').replace(/\D/g,'')));
  const grid = qs('#productGrid'); grid.innerHTML=''; list.forEach(p=>grid.appendChild(productCard(p)));
  const reco = qs('#recoGrid'); reco.innerHTML=''; products.slice(0,6).forEach(p=>reco.appendChild(productCard(p)));
}

/** DETAIL */
function openDetail(p){
  currentDetail = p;
  qs('#detailImg').style.backgroundImage = `url('${p.img}')`;
  qs('#detailTitle').textContent = p.title;
  qs('#detailMeta').textContent = 'Poppi Pertiwi â€¢ Coconut Books';
  qs('#detailSold').textContent = p.sold;
  qs('#detailPrice').textContent = rupiah(p.price);
  qs('#detailDesc').textContent = p.desc.replace(/\n/g,'\n');
  document.getElementById('detailModal').showModal();
}
function buyNow(){
  addToCart(currentDetail);
  document.getElementById('detailModal').close();
  go('#/checkout');
}

/** CART */
function addToCart(p){
  const i = state.cart.findIndex(x=>x.id===p.id);
  if(i>-1){ state.cart[i].qty++; } else { state.cart.push({id:p.id,qty:1}); }
  save();
  alert('Ditambahkan ke keranjang');
}
function removeFromCart(id){
  state.cart = state.cart.filter(x=>x.id!==id);
  save(); renderCart();
}
function setQty(id,delta){
  const item = state.cart.find(x=>x.id===id);
  if(!item) return;
  item.qty = Math.max(1, item.qty+delta);
  save(); renderCart();
}
function renderCart(){
  const empty = qs('#cartEmpty'), wrap=qs('#cartWrap');
  if(state.cart.length===0){ empty.style.display='block'; wrap.style.display='none'; return; }
  empty.style.display='none'; wrap.style.display='block';
  const tbody = qs('#cartTable tbody'); tbody.innerHTML='';
  let sub = 0;
  state.cart.forEach(row=>{
    const p = products.find(pp=>pp.id===row.id);
    const tr = document.createElement('tr');
    const subtotal = p.price*row.qty; sub+=subtotal;
    tr.innerHTML = `
      <td><strong>${p.title}</strong></td>
      <td>${rupiah(p.price)}</td>
      <td class="qty">
        <button onclick="setQty('${p.id}',-1)">-</button>
        <span style="display:inline-block;width:34px;text-align:center">${row.qty}</span>
        <button onclick="setQty('${p.id}',1)">+</button>
      </td>
      <td>${rupiah(subtotal)}</td>
      <td><button class="btn ghost" onclick="removeFromCart('${p.id}')">Hapus</button></td>
    `;
    tbody.appendChild(tr);
  });
  const ship=8000, fee=2000, shipDisc=8000, voucher=0;
  const grand = sub + ship + fee - shipDisc - voucher;
  qs('#tSubtotal').textContent = rupiah(sub);
  qs('#tShip').textContent = rupiah(ship);
  qs('#tFee').textContent = rupiah(fee);
  qs('#tShipDisc').textContent = `-${rupiah(shipDisc)}`;
  qs('#tVoucher').textContent = voucher? `-${rupiah(voucher)}` : '-';
  qs('#tGrand').textContent = rupiah(grand);
}

/** CHECKOUT */
function renderCheckout(){
  // tampilkan ringkasan sama seperti di cart
  let sub=0;
  const items = state.cart.map(row=>{
    const p = products.find(pp=>pp.id===row.id);
    sub += p.price*row.qty;
    return {...p, qty:row.qty};
  });
  qs('#checkoutItems').innerHTML = '';
  items.forEach(it=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="pad" style="display:flex;gap:12px;align-items:center">
        <div style="width:60px;height:80px;border-radius:10px;background:#eee;background-image:url('${it.img}');background-size:cover"></div>
        <div style="flex:1">
          <div style="font-weight:700">${it.title}</div>
          <div class="muted">x ${it.qty}</div>
        </div>
        <div class="price">${rupiah(it.price*it.qty)}</div>
      </div>`;
    qs('#checkoutItems').appendChild(card);
  });
  const ship=8000, fee=2000, shipDisc=8000, voucher=0;
  const grand = sub + ship + fee - shipDisc - voucher;
  qs('#cSubtotal').textContent = rupiah(sub);
  qs('#cShip').textContent = rupiah(ship);
  qs('#cFee').textContent = rupiah(fee);
  qs('#cShipDisc').textContent = `-${rupiah(shipDisc)}`;
  qs('#cVoucher').textContent = voucher? `-${rupiah(voucher)}` : '-';
  qs('#cGrand').textContent = rupiah(grand);
}

/** PLACE ORDER */
function placeOrder(){
  if(state.cart.length===0){ alert('Keranjang kosong'); return; }
  // ambil alamat
  const f = new FormData(qs('#addrForm'));
  const addr = Object.fromEntries(f.entries());
  const items = state.cart.map(x=>{
    const p = products.find(pp=>pp.id===x.id);
    return {id:p.id,title:p.title,price:p.price,qty:x.qty};
  });
  const subtotal = items.reduce((a,b)=>a+b.price*b.qty,0);
  const ship=8000, fee=2000, shipDisc=8000, voucher=0;
  const total = subtotal + ship + fee - shipDisc - voucher;
  const order = {
    id:'ORD'+Math.random().toString(36).slice(2,8).toUpperCase(),
    when: new Date().toISOString(),
    addr, items, subtotal, ship, fee, shipDisc, voucher, total, status:'Diproses'
  };
  state.orders.unshift(order);
  state.cart = [];
  save();
  go('#/success');
}

/** ORDERS */
function renderOrders(){
  const wrap = qs('#ordersWrap'); wrap.innerHTML='';
  if(state.orders.length===0){ wrap.innerHTML='<div class="muted">Belum ada pesanan.</div>'; return; }
  state.orders.forEach(o=>{
    const card = document.createElement('div');
    card.className='card';
    const items = o.items.map(i=>`${i.title} x ${i.qty}`).join('<br>');
    card.innerHTML = `
      <div class="pad">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>${o.id}</strong>
          <span class="tag">${o.status}</span>
        </div>
        <div class="muted" style="margin:6px 0">${new Date(o.when).toLocaleString('id-ID')}</div>
        <div style="margin:6px 0">${items}</div>
        <div class="price" style="margin-top:6px">${rupiah(o.total)}</div>
      </div>`;
    wrap.appendChild(card);
  });
}

/** INIT */
renderHeader();
show(location.hash||'#/home');
</script>
</body>
</html>
